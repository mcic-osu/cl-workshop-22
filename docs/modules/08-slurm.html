<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.0.38">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Jelmer Poelstra">

<title>Slurm</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="../site_libs/quarto-contrib/fontawesome6-0.1.0/all.css" rel="stylesheet">
<link href="../site_libs/quarto-contrib/fontawesome6-0.1.0/latex-fontsize.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Command line workshop ’22</span>
  </a>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-day-1" role="button" data-bs-toggle="dropdown" aria-expanded="false">Day 1</a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-day-1">    
        <li>
    <a class="dropdown-item" href="../modules/01-intro.html">
 <span class="dropdown-text">1. Workshop Intro</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../modules/02-osc.html">
 <span class="dropdown-text">2. OSC Intro</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../modules/03-vscode.html">
 <span class="dropdown-text">3. VS Code</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../modules/04-shell.html">
 <span class="dropdown-text">4. The Unix Shell</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-day-2" role="button" data-bs-toggle="dropdown" aria-expanded="false">Day 2</a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-day-2">    
        <li>
    <a class="dropdown-item" href="../modules/05-vars-loops.html">
 <span class="dropdown-text">5. Variables and Loops</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../modules/06-scripts.html">
 <span class="dropdown-text">6. Shell Scripting</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../modules/07-software.html">
 <span class="dropdown-text">7. Software at OSC</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-day-3" role="button" data-bs-toggle="dropdown" aria-expanded="false">Day 3</a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-day-3">    
        <li>
    <a class="dropdown-item" href="../modules/08-slurm.html">
 <span class="dropdown-text">8. Compute Jobs with Slurm</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../modules/09-examples.html">
 <span class="dropdown-text">9. Batch Jobs in Practice</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-additional-info" role="button" data-bs-toggle="dropdown" aria-expanded="false">Additional info</a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-additional-info">    
        <li>
    <a class="dropdown-item" href="../info/info.html">
 <span class="dropdown-text">Practical Workshop Info</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../info/about.html">
 <span class="dropdown-text">General Workshop Info / Signing Up</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../info/glossary.html">
 <span class="dropdown-text">Glossary</span></a>
  </li>  
    </ul>
  </li>
</ul>
              <div class="quarto-toggle-container">
                  <a href="" class="quarto-color-scheme-toggle nav-link" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
              </div>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#setup" id="toc-setup" class="nav-link active" data-scroll-target="#setup"> <span class="header-section-number">1</span> Setup</a></li>
  <li><a href="#interactive-shell-jobs" id="toc-interactive-shell-jobs" class="nav-link" data-scroll-target="#interactive-shell-jobs"> <span class="header-section-number">2</span> Interactive shell jobs</a>
  <ul class="collapse">
  <li><a href="#using-srun" id="toc-using-srun" class="nav-link" data-scroll-target="#using-srun"> <span class="header-section-number">2.1</span> Using <code>srun</code></a></li>
  <li><a href="#compute-job-options" id="toc-compute-job-options" class="nav-link" data-scroll-target="#compute-job-options"> <span class="header-section-number">2.2</span> Compute job options</a></li>
  </ul></li>
  <li><a href="#intro-to-batch-jobs" id="toc-intro-to-batch-jobs" class="nav-link" data-scroll-target="#intro-to-batch-jobs"> <span class="header-section-number">3</span> Intro to batch jobs</a>
  <ul class="collapse">
  <li><a href="#the-sbatch-command" id="toc-the-sbatch-command" class="nav-link" data-scroll-target="#the-sbatch-command"> <span class="header-section-number">3.1</span> The <code>sbatch</code> command</a></li>
  <li><a href="#adding-sbatch-options-in-scripts" id="toc-adding-sbatch-options-in-scripts" class="nav-link" data-scroll-target="#adding-sbatch-options-in-scripts"> <span class="header-section-number">3.2</span> Adding <code>sbatch</code> options in scripts</a></li>
  <li><a href="#where-does-the-output-go" id="toc-where-does-the-output-go" class="nav-link" data-scroll-target="#where-does-the-output-go"> <span class="header-section-number">3.3</span> Where does the output go?</a></li>
  </ul></li>
  <li><a href="#common-sbatch-options" id="toc-common-sbatch-options" class="nav-link" data-scroll-target="#common-sbatch-options"> <span class="header-section-number">4</span> Common <code>sbatch</code> options</a>
  <ul class="collapse">
  <li><a href="#account-the-osc-project" id="toc-account-the-osc-project" class="nav-link" data-scroll-target="#account-the-osc-project"> <span class="header-section-number">4.1</span> <code>--account</code>: The OSC project</a></li>
  <li><a href="#time-time-limit-wall-time" id="toc-time-time-limit-wall-time" class="nav-link" data-scroll-target="#time-time-limit-wall-time"> <span class="header-section-number">4.2</span> <code>--time</code>: Time limit (“wall time”)</a></li>
  <li><a href="#mem-ram-memory" id="toc-mem-ram-memory" class="nav-link" data-scroll-target="#mem-ram-memory"> <span class="header-section-number">4.3</span> <code>--mem</code>: RAM memory</a></li>
  <li><a href="#cores-nodes-and-tasks" id="toc-cores-nodes-and-tasks" class="nav-link" data-scroll-target="#cores-nodes-and-tasks"> <span class="header-section-number">4.4</span> Cores (&amp; nodes and tasks)</a></li>
  <li><a href="#output-slurm-log-files" id="toc-output-slurm-log-files" class="nav-link" data-scroll-target="#output-slurm-log-files"> <span class="header-section-number">4.5</span> <code>--output</code>: Slurm log files</a></li>
  <li><a href="#other-sbatch-options" id="toc-other-sbatch-options" class="nav-link" data-scroll-target="#other-sbatch-options"> <span class="header-section-number">4.6</span> Other <code>sbatch</code> options</a></li>
  </ul></li>
  <li><a href="#addendum-table-with-all-discussed-sbatch-options" id="toc-addendum-table-with-all-discussed-sbatch-options" class="nav-link" data-scroll-target="#addendum-table-with-all-discussed-sbatch-options"> <span class="header-section-number">5</span> Addendum: Table with all discussed <code>sbatch</code> options</a></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/mcic-osu/cl-workshop-22/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Compute Jobs with Slurm</h1>
<p class="subtitle lead">With a focus on submitting shell scripts as “batch jobs”</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Jelmer Poelstra </p>
          </div>
  </div>
    
    
  </div>
  

</header>

<div class="cell">

</div>
<div class="callout-warning callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>PAGE STILL UNDER CONSTRUCTION</p>
</div>
</div>
<hr>
<p><br></p>
<p>We have so far been working on <em>login nodes</em> at OSC, but in order to run some actual analyses, you will need access to <strong>compute nodes</strong>.</p>
<p>Automated scheduling software allows hundreds of people with different requirements to access compute nodes effectively and fairly. For this purpose, OSC uses the <strong>Slurm</strong> scheduler (<strong>S</strong>imple <strong>l</strong>inux <strong>u</strong>tility for <strong>r</strong>esource <strong>m</strong>anagement).</p>
<p>A temporary reservation of (parts of) a compute node is called a <em>compute job</em>. What are the options to start a compute job at OSC?</p>
<ol type="1">
<li>“<strong>Interactive Apps</strong>” — We can start programs with GUIs, such as RStudio or Jupyter Notebook on OnDemand, and they will run in a browser window.</li>
<li><strong>Interactive shell jobs</strong> — Start a Bash shell on a compute node.</li>
<li><strong>Batch (non-interactive) jobs</strong>: — Run a <em>script</em> on a compute node.</li>
</ol>
<p>When running command-line programs for genomics analyses, <em>batch jobs</em> are the most useful and will be the focus of this module. We’ll also touch on <em>interactive shell jobs</em>, which can occasionally be handy and are requested and managed in a very similar way to batch jobs.</p>
<section id="setup" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="setup"><span class="header-section-number">1</span> Setup</h2>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Starting a VS Code session with an active terminal (click here)
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ol type="1">
<li>Log in to OSC at <a href="https://ondemand.osc.edu" class="uri">https://ondemand.osc.edu</a>.</li>
<li>In the blue top bar, select <code>Interactive Apps</code> and then <code>Code Server</code>.</li>
<li>In the form that appears:
<ul>
<li>Enter <code>3</code> in the box <code>Number of hours</code></li>
<li>Enter <code>/fs/ess/scratch/PAS2250</code> in the box <code>Working Directory</code></li>
<li>Click <code>Launch</code>.</li>
</ul></li>
<li>On the next page, once the top bar of the box is green and says <code>Runnning</code>, click <code>Connect to VS Code</code>.</li>
<li>Open a terminal: <i class="fa-solid fa-bars" aria-hidden="true"></i> &nbsp; =&gt; <code>Terminal</code> =&gt; <code>New Terminal</code>.</li>
<li>In the terminal, type <code>bash</code> and press <kbd>Enter</kbd>.</li>
</ol>
</div>
</div>
</div>
<p><br></p>
</section>
<section id="interactive-shell-jobs" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="interactive-shell-jobs"><span class="header-section-number">2</span> Interactive shell jobs</h2>
<p>Interactive shell jobs will grant you interactive shell access on a compute node. Working in an interactive shell job is operationally identical to working on a login node as we’ve been doing so far, but <strong>the difference is that it’s now okay to use significant computing resources</strong>. (How much and for how long depends on what you reserve.)</p>
<section id="using-srun" class="level3" data-number="2.1">
<h3 data-number="2.1" class="anchored" data-anchor-id="using-srun"><span class="header-section-number">2.1</span> Using <code>srun</code></h3>
<p>A couple of different commands can be used to start an interactive shell job. I prefer the general <code>srun</code> command<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>, which we can use with the <code>--pty /bin/bash</code> option to get an interactive Bash shell.</p>
<p>However, if we run that command without additional options, we get an error:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">srun</span> <span class="at">--pty</span> /bin/bash</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="bash-out">
<p>srun: error: ERROR: Job invalid: Must specify account for job<br>
srun: error: Unable to allocate resources: Unspecified error</p>
</div>
<p>As the error message <code>Must specify account for job</code> tries to tell us, <strong>we need to indicate which <em>OSC project</em> (or as SLURM puts it, “<em>account</em>”)</strong> <strong>we want to use</strong> for this compute job. This is because an OSC project always has to be charged for the computing resources used during a compute job.</p>
<p>To specify the project/account, we can use the <code>--account=</code> option followed by the project number:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ex">srun</span> <span class="at">--account</span><span class="op">=</span>PAS2250 <span class="at">--pty</span> /bin/bash</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="bash-out">
<p>srun: job 12431932 queued and waiting for resources<br>
srun: job 12431932 has been allocated resources</p>
<p>[…regular login info, such as quota, not shown…]</p>
<p>[jelmer@p0133 PAS2250]$</p>
</div>
<p>There we go! First we got some Slurm scheduling info:</p>
<ul>
<li>Initially, the job is “queued”: that is, waiting to start.</li>
<li>Very soon (usually!), the job has been “allocated resources”: that is, computing resources such as a compute node were found and reserved for the job.</li>
</ul>
<p>Then:</p>
<ul>
<li><p>The job starts and because we’ve reserved an <em>interactive</em> shell job, this means that a new Bash shell is initiated: for that reason, we get to see our regular login info once again.</p></li>
<li><p>Most importantly, we are no longer on a login node but on a <strong>compute node</strong>, as our prompt hints at: we switched from something like <code>[jelmer@pitzer-login04 PAS2250]$</code> to the <code>[jelmer@p0133 PAS2250]$</code> shown above.</p></li>
<li><p>Note also that the job has a number (above: <code>job 12431932</code>): every compute job has such a <strong>unique identifier</strong> among all jobs by all users at OSC, and we can use this number to monitor and manage it. All of us will therefore see a different job number pop up.</p></li>
</ul>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
OSC projects
</div>
</div>
<div class="callout-body-container callout-body">
<p>During this workshop, we can all use the project <code>PAS2250</code>, which is actually a project that OSC has freely given me to introduce people to working at OSC. The project will still be charged but the credits on it were freely awarded.</p>
<p>To work on your own research project at OSC, you will either have to get your own project (typically, PIs get one for their lab or for a specific research project) or you can become an MCIC member and use the MCIC project.</p>
</div>
</div>
</section>
<section id="compute-job-options" class="level3" data-number="2.2">
<h3 data-number="2.2" class="anchored" data-anchor-id="compute-job-options"><span class="header-section-number">2.2</span> Compute job options</h3>
<p>The <code>--account=</code> option is just one of out of <em>many</em> options we can use when reserving a compute job, but is the only one that <em>always</em> has to be specified (including for batch jobs and for Interactive Apps).</p>
<p>Defaults exist for all other options, such as the amount of time (1 hour) and the number of cores (1). These options are all specified in the same way for interactive and batch jobs, and we’ll dive into them below.</p>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Many SLURM options have a long format (<code>--account=PAS2250</code>) and a short format (<code>-A PAS2250</code>), which can generally be used interchangeably. For clarity, we’ll try to stick to long format options during this workshop.</p>
</div>
</div>
<p><br></p>
</section>
</section>
<section id="intro-to-batch-jobs" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="intro-to-batch-jobs"><span class="header-section-number">3</span> Intro to batch jobs</h2>
<p>When requesting batch jobs, we are asking the Slurm scheduler to <em>run a script</em> on a compute node. For this reason, we can also refer to it as “submitting a script (to the queue)”.</p>
<p>In contrast to interactive shell jobs, we stay in our current shell on a login node when submitting a script, and cannot really interact with the process on the compute node, other than:</p>
<ul>
<li><strong>Output from the script that would normally be printed to screen ends up in</strong> <strong>a file</strong>.</li>
<li>We can do things like <strong>monitoring</strong> whether the job is still running and <strong>cancelling</strong> the job, which will revoke the compute node reservation and stop the ongoing process.</li>
</ul>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>The script that we submit can be in different languages but typically, including in all examples in this workshop, they are shell (Bash) scripts.</p>
</div>
</div>
<section id="the-sbatch-command" class="level3" data-number="3.1">
<h3 data-number="3.1" class="anchored" data-anchor-id="the-sbatch-command"><span class="header-section-number">3.1</span> The <code>sbatch</code> command</h3>
<p>Whereas we used Slurm’s <code>srun</code> command to start an interactive shell job, we use its <strong><code>sbatch</code></strong> command to submit a script.</p>
<p>Recall from the Bash scripting module that we can run a Bash script as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bash</span> printname.sh Jane Doe</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="bash-out"><code>First name: Jane
Last name: Doe</code></pre>
</div>
</div>
<div class="callout-caution callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-6-contents" aria-controls="callout-6" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Can’t find the printname.sh script?
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-6" class="callout-6-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ul>
<li>Open a new file in the <code>VS Code</code> editor (&nbsp; <i class="fa-solid fa-bars" aria-hidden="true"></i> &nbsp; =&gt; &nbsp; <code>File</code> &nbsp; =&gt; &nbsp; <code>New File</code>) and save it as <code>printname.sh</code></li>
<li>Copy the code below into the script:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="bu">set</span> <span class="at">-ueo</span> pipefail</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="va">first_name</span><span class="op">=</span><span class="va">$1</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="va">last_name</span><span class="op">=</span><span class="va">$2</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">"First name: </span><span class="va">$first_name</span><span class="st">"</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">"Last name: </span><span class="va">$last_name</span><span class="st">"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<p>The above command ran the script on our current node, a login node. To instead submit the script to the Slurm queue, we would start by simply <strong>replacing <code>bash</code> by <code>sbatch</code></strong>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> printname.sh Jane Doe</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="bash-out">
<p>srun: error: ERROR: Job invalid: Must specify account for job<br>
srun: error: Unable to allocate resources: Unspecified error</p>
</div>
<p>As we’ve learned, we always have to specify the OSC account when submitting a compute job. Conveniently, we can also specify Slurm/<code>sbatch</code> options inside our script, but first, let’s add the <code>--account</code> option on the command line:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">--account</span><span class="op">=</span>PAS2250 printname.sh Jane Doe</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="bash-out">
<p>Submitted batch job 12431935</p>
</div>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
<code>sbatch</code> options vs.&nbsp;script arguments
</div>
</div>
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> [sbatch-options] myscript.sh [script-arguments]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> printname.sh                             <span class="co"># No options/arguments for either</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> printname.sh Jane Doe                    <span class="co"># Script arguments but no sbatch option</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">--account</span><span class="op">=</span>PAS2250 printname.sh           <span class="co"># sbatch option but no script arguments</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">--account</span><span class="op">=</span>PAS2250 printname.sh Jane Doe  <span class="co"># Both sbatch option and script arguments</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</section>
<section id="adding-sbatch-options-in-scripts" class="level3" data-number="3.2">
<h3 data-number="3.2" class="anchored" data-anchor-id="adding-sbatch-options-in-scripts"><span class="header-section-number">3.2</span> Adding <code>sbatch</code> options in scripts</h3>
<p>Instead of specifying Slurm/<code>sbatch</code> options on the command-line when we submit the script, we can also add these options <em>inside the script</em>.</p>
<p>This is handy because even though we have so far only seen the <code>account=</code> option, you often want to specify several options. That would lead to very long <code>sbatch</code> commands. Additionally, it can be practical to store a script’s typical Slurm options along with the script itself.</p>
<p>We add the options in the script using another type of special comment line akin to the shebang line, marked by <code>#SBATCH</code>. The equivalent of adding <code>--account=PAS2250</code> after <code>sbatch</code> on the command line, is a line in a script that reads <code>#SBATCH --account=PAS2250</code>.</p>
<p>Just like the shebang line, the <code>#SBATCH</code> line(s) should be at the top of the script. Let’s add one to the <code>printname.sh</code> script, such that the first few lines read:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --account=PAS2250</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="bu">set</span> <span class="at">-ueo</span> pipefail</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>After having added this to the script, we <em>can</em> successfully run our earlier <code>sbatch</code> command without options:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> printname.sh Jane Doe</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="bash-out">
<p>Submitted batch job 12431942</p>
</div>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Running a script with <code>#SBATCH</code> in other contexts
</div>
</div>
<div class="callout-body-container callout-body">
<p>Because <code>#SBATCH</code> lines are special <em>comment</em> lines, they will simply be ignored and not throw any errors when you run a script that contains them in other contexts: when not running them as a batch job at OSC, or even when running them on a computer without Slurm installed.</p>
</div>
</div>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
<code>sbatch</code> option precedence
</div>
</div>
<div class="callout-body-container callout-body">
<p>Any <code>sbatch</code> option provided on the command line will override the equivalent option provided inside the script. This is sensible: we can provide “defaults” inside the script, and change one or more of those when needed on the command line.</p>
</div>
</div>
</section>
<section id="where-does-the-output-go" class="level3" data-number="3.3">
<h3 data-number="3.3" class="anchored" data-anchor-id="where-does-the-output-go"><span class="header-section-number">3.3</span> Where does the output go?</h3>
<p>Above, we saw that when we ran the <code>printname.sh</code> script directly, its output was printed to the screen, whereas when we submitted it as a batch job, we merely got <code>Submitted batch job 12431942</code> printed to screen. So where did our output go?</p>
<p>It ended up in a file <code>slurm-12431942.out</code> (i.e., <code>slurm-&lt;job-number&gt;.out</code>), which we might call a <strong>Slurm log file</strong>.</p>
<div class="callout-caution callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-10-contents" aria-controls="callout-10" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Any idea why we might not want batch job output printed to screen, even if we could?
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-10" class="callout-10-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>The power of submitting batch jobs is that you can submit many at once, e.g.&nbsp;one per sample, running the same script. If the output from all those scripts ends up on your screen, things become a big mess, and you have no lasting record of what happened.</p>
</div>
</div>
</div>
<p>It’s important to conceptually distinguish two broad types of output that a script may have:</p>
<ul>
<li><p>Output that is <strong>printed to screen</strong> when we directly run a script, such as what was produced by our <code>echo</code> statements, by any errors that may occur, and possibly by a program that we run in the script.<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> As we saw, this output ends up in the <strong>Slurm log file</strong> when we submit the script as a batch job.</p></li>
<li><p>Output that we redirect to a file (<code>&gt; myfile.txt</code>) or that a program that we run in the script writes to file(s). This type of output <strong>will always end up in those very same files</strong> regardless of whether we run the script directly or as a batch job.</p></li>
</ul>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Both interactive and batch jobs start in the directory that they were submitted from: that is, your working directory will remain the same.</p>
</div>
</div>
<p><br></p>
</section>
</section>
<section id="common-sbatch-options" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="common-sbatch-options"><span class="header-section-number">4</span> Common <code>sbatch</code> options</h2>
<section id="account-the-osc-project" class="level3" data-number="4.1">
<h3 data-number="4.1" class="anchored" data-anchor-id="account-the-osc-project"><span class="header-section-number">4.1</span> <code>--account</code>: The OSC project</h3>
<p>As seen above. <em>Always</em> specify the project when submitting a batch job.</p>
</section>
<section id="time-time-limit-wall-time" class="level3" data-number="4.2">
<h3 data-number="4.2" class="anchored" data-anchor-id="time-time-limit-wall-time"><span class="header-section-number">4.2</span> <code>--time</code>: Time limit (“wall time”)</h3>
<p>Specify the maximum amount of time your job will run for. Wall time is a term meant to distinguish it from, say “core hours”: if a job runs for 2 hour and used 8 cores, the wall time was 2 hours and the number of core hours was 2 x 8 = 16.</p>
<ul>
<li>Your job gets killed as soon as it hits the specified time limit!</li>
<li>You will only be charged for the time your job <em>actually used</em>.</li>
<li>In general, shorter jobs are likely to start running sooner</li>
<li>The default is 1 hour. Acceptable time formats include:
<ul>
<li><code>minutes</code></li>
<li><code>hours:minutes:seconds</code></li>
<li><code>days-hours</code></li>
</ul></li>
<li>For single-node jobs, up to 168 hours (7 days) can be requested. If that’s not enough, you can request access to the <code>longserial</code> queue for jobs of up to 336 hours (14 days).</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --time=1:00:00</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>If you are uncertain about the time your job will take, ask for (much) more time than you think you will need.</p>
</div>
</div>
</section>
<section id="mem-ram-memory" class="level3" data-number="4.3">
<h3 data-number="4.3" class="anchored" data-anchor-id="mem-ram-memory"><span class="header-section-number">4.3</span> <code>--mem</code>: RAM memory</h3>
<p>Specify a maximum amount of RAM (Random Access Memory) that your job can use.</p>
<ul>
<li>The default unit is MB (MegaBytes) — use “G” for GB.</li>
<li>The default amount is 4 GB per core that you reserve (see below).</li>
<li>Like with the time limit, your job gets killed when it hits the memory limit. But this is not that common so I would usually not specify unless the program I’m running reports that it needs a lot of memory, or I got “out-of-memory” errors when trying to run the script before.</li>
</ul>
<div class="sourceCode" id="cb13"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --mem=20G</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="cores-nodes-and-tasks" class="level3" data-number="4.4">
<h3 data-number="4.4" class="anchored" data-anchor-id="cores-nodes-and-tasks"><span class="header-section-number">4.4</span> Cores (&amp; nodes and tasks)</h3>
<p>Specify the number of nodes (≈ computers), cores, or “tasks” (processes). These are separate but related options, and this is where things can get confusing!</p>
<ul>
<li>Slurm for the most part uses “<strong>core</strong>” and “<strong>CPU</strong>” interchangeably<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a>. More generally, “<strong>thread</strong>” is <em>also</em> commonly used interchangeably with core/CPU<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a>.</li>
</ul>
<ul>
<li><p>Running a program that uses multiple threads/cores/CPUs (“multi-threading”) is common. In such cases, specify the number of threads/cores/CPUs <code>n</code> with <code>--cpus-per-task=n</code> (and keep <code>--nodes</code> and <code>--ntasks</code> at their defaults of 1).</p>
<p>The program you’re running may have an argument like <code>--cores</code> or <code>--threads</code>, which you should then set to <code>n</code> as well.</p></li>
</ul>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Uncommon cases
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Only ask for <strong>&gt;1 node</strong> when you have explicit parallelization with something like “MPI”, which is uncommon in bioinformatics.</li>
<li>For jobs with multiple processes (tasks), use <code>--ntasks=n</code> or <code>--ntasks-per-node=n</code>.</li>
</ul>
</div>
</div>
<table class="table">
<colgroup>
<col style="width: 40%">
<col style="width: 13%">
<col style="width: 32%">
<col style="width: 13%">
</colgroup>
<thead>
<tr class="header">
<th>Resource/use</th>
<th>short</th>
<th>long</th>
<th style="text-align: center;">default</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Nr. of cores/CPUs/threads (per task)</td>
<td><code>-c 1</code></td>
<td><code>--cpus-per-task=1</code></td>
<td style="text-align: center;">1</td>
</tr>
<tr class="even">
<td>Nr. of “tasks” (processes)</td>
<td><code>-n 1</code></td>
<td><code>--ntasks=1</code></td>
<td style="text-align: center;">1</td>
</tr>
<tr class="odd">
<td>Nr. of tasks per node</td>
<td>-</td>
<td><code>--ntasks-per-node=1</code></td>
<td style="text-align: center;">1</td>
</tr>
<tr class="even">
<td>Nr. of nodes</td>
<td><code>-N 1</code></td>
<td><code>--nodes=1</code></td>
<td style="text-align: center;">1</td>
</tr>
</tbody>
</table>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --cpus-per-task=2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="output-slurm-log-files" class="level3" data-number="4.5">
<h3 data-number="4.5" class="anchored" data-anchor-id="output-slurm-log-files"><span class="header-section-number">4.5</span> <code>--output</code>: Slurm log files</h3>
<p>As we saw above, by default, all output from a script that would normally<a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a> be printed to screen will end up in Slurm log file when we submit the script as a batch job. This file will be created in the directory from which you submitted the script, and will be called <code>slurm-&lt;job-number&gt;.out</code>, e.g.&nbsp;<code>slurm-12431942.out</code>.</p>
<p>But it is possible to change the name of this file. For instance, it can be useful to include the name of the program that the script runs, so that it’s easier to recognize this file later.</p>
<p>We can do this with the <code>--output</code> option, e.g.&nbsp;<code>--output=slurm-fastqc.out</code> if we were running FastQC.</p>
<p>However, you’ll generally want to keep the batch job number in the file name too<a href="#fn6" class="footnote-ref" id="fnref6" role="doc-noteref"><sup>6</sup></a>. Since we won’t know the batch job number in advance, we need a trick here and that is to use <strong><code>%j</code>, which represents the batch job number</strong>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --output=slurm-fastqc-%j.out</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
<code>stdout</code> and <code>stderr</code>
</div>
</div>
<div class="callout-body-container callout-body">
<p>By default, two output streams “standard output” (<code>stdout</code>) and “standard error” (<code>stderr</code>) all end up in the same Slurm log file, but it is also possible to separate them into two separate files.</p>
<p>Because <code>stderr</code>, as you might have guessed, often contains error messages, it could be useful to have those in a separate file. You can make that happen with the <code>--error</code> option, e.g.&nbsp;<code>--error=slurm-fastqc-%j.err</code>.</p>
<p>However, reality is more messy: some programs print their main output not to a file but to standard out, and their logging output, errors and regular messages alike, to standard error. Yet other programs use <code>stdout</code> or <code>stderr</code> for <em>all</em> messages. I therefore usually only use <code>--output</code>.</p>
</div>
</div>
</section>
<section id="other-sbatch-options" class="level3" data-number="4.6">
<h3 data-number="4.6" class="anchored" data-anchor-id="other-sbatch-options"><span class="header-section-number">4.6</span> Other <code>sbatch</code> options</h3>
<p>Here are some other <code>sbatch</code> options that can be useful in certain cases:</p>
<table class="table">
<colgroup>
<col style="width: 44%">
<col style="width: 55%">
</colgroup>
<thead>
<tr class="header">
<th>Resource/use</th>
<th>long option</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Job name (displayed in the queue)</td>
<td><code>--job-name=fastqc</code></td>
</tr>
<tr class="even">
<td>Partition (=queue type)</td>
<td><code>--partition=longserial</code> (long jobs) <br> <code>--partition=hugemem</code> (jobs needing lots of memory)</td>
</tr>
<tr class="odd">
<td>Get email when job starts, ends, fails, <br> or all of the above</td>
<td><code>--mail-type=START</code> <br> <code>--mail-type=END</code> <br> <code>--mail-type=FAIL</code> <br> <code>--mail-type=ALL</code></td>
</tr>
<tr class="even">
<td>Let job begin at/after specific time</td>
<td><code>--begin=2021-02-01T12:00:00</code></td>
</tr>
<tr class="odd">
<td>Let job begin after other job is done</td>
<td><code>--dependency=afterany:123456</code></td>
</tr>
</tbody>
</table>
<p><br></p>
</section>
</section>
<section id="addendum-table-with-all-discussed-sbatch-options" class="level2" data-number="5">
<h2 data-number="5" class="anchored" data-anchor-id="addendum-table-with-all-discussed-sbatch-options"><span class="header-section-number">5</span> Addendum: Table with all discussed <code>sbatch</code> options</h2>
<table class="table">
<colgroup>
<col style="width: 40%">
<col style="width: 15%">
<col style="width: 28%">
<col style="width: 14%">
</colgroup>
<thead>
<tr class="header">
<th>Resource/use</th>
<th>short</th>
<th>long</th>
<th style="text-align: center;">default</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Project to be billed</td>
<td><code>-A PAS0471</code></td>
<td><code>--account=PAS0471</code></td>
<td style="text-align: center;"><em>N/A</em></td>
</tr>
<tr class="even">
<td>Time limit</td>
<td><code>-t 4:00:00</code></td>
<td><code>--time=4:00:00</code></td>
<td style="text-align: center;">1:00:00</td>
</tr>
<tr class="odd">
<td>Nr of nodes</td>
<td><code>-N 1</code></td>
<td><code>--nodes=1</code></td>
<td style="text-align: center;">1</td>
</tr>
<tr class="even">
<td>Nr of cores</td>
<td><code>-c 1</code></td>
<td><code>--cpus-per-task=1</code></td>
<td style="text-align: center;">1</td>
</tr>
<tr class="odd">
<td>Nr of “tasks” (processes)</td>
<td><code>-n 1</code></td>
<td><code>--ntasks=1</code></td>
<td style="text-align: center;">1</td>
</tr>
<tr class="even">
<td>Nr of tasks per node</td>
<td>-</td>
<td><code>--ntasks-per-node</code></td>
<td style="text-align: center;">1</td>
</tr>
<tr class="odd">
<td>Memory limit per node</td>
<td>-</td>
<td><code>--mem=4G</code></td>
<td style="text-align: center;"><em>(4G)</em></td>
</tr>
<tr class="even">
<td>Log output file (%j = job number)</td>
<td><code>-o</code></td>
<td><code>--output=slurm-fastqc-%j.out</code></td>
<td style="text-align: center;"></td>
</tr>
<tr class="odd">
<td>Error output (<em>stderr</em>)</td>
<td><code>-e</code></td>
<td><code>--error=slurm-fastqc-%j.err</code></td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td>Job name (displayed in the queue)</td>
<td>-</td>
<td><code>--job-name=fastqc</code></td>
<td style="text-align: center;"></td>
</tr>
<tr class="odd">
<td>Partition (=queue type)</td>
<td>-</td>
<td><code>--partition=longserial</code> (long jobs) <br> <code>--partition=hugemem</code> (jobs needing lots of memory)</td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td>Get email when job starts, ends, fails, <br> or all of the above</td>
<td>-</td>
<td><code>--mail-type=START</code> <br> <code>--mail-type=END</code> <br> <code>--mail-type=FAIL</code> <br> <code>--mail-type=ALL</code></td>
<td style="text-align: center;"></td>
</tr>
<tr class="odd">
<td>Let job begin at/after specific time</td>
<td>-</td>
<td><code>--begin=2021-02-01T12:00:00</code></td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td>Let job begin after other job is done</td>
<td>-</td>
<td><code>--dependency=afterany:123456</code></td>
<td style="text-align: center;"></td>
</tr>
</tbody>
</table>
<p><br></p>


</section>


<div id="quarto-appendix" class="default"><section class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1" role="doc-endnote"><p>Other options: <code>salloc</code> works almost identically to <code>srun</code>, whereas <code>sinteractive</code> is an OSC convenience wrapper but with very limited options.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2" role="doc-endnote"><p>Even though technically, one CPU often contains multiple cores.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3" role="doc-endnote"><p>Even though technically, one CPU often contains multiple cores.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4" role="doc-endnote"><p>Even though technically, one core often contains multiple threads.<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5" role="doc-endnote"><p>That is, when we run the script directly, e.g.&nbsp;<code>bash myscript.sh</code><a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn6" role="doc-endnote"><p>For instance, we might be running the FastQC script multiple times, and otherwise those would all have the same name and be overwritten.<a href="#fnref6" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } 
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">2022, Jelmer Poelstra</div>   
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/mcic-osu/cl-workshop-22">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>



</body></html>